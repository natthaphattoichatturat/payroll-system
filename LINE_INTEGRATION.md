# LINE Integration Guide

## ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Overview)

‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE Messaging API ‡πÅ‡∏•‡∏∞ LINE LIFF (LINE Front-end Framework) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:

### 1. ü§ñ AI Agent (LINE Bot) - ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
- **‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà chatbot ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤** - ‡πÄ‡∏õ‡πá‡∏ô AI Agent ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
- **Function Calling** - AI ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ functions ‡πÄ‡∏û‡∏∑‡πà‡∏≠ query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase
- **Real-time Data** - ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≠‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- **5 Functions ‡∏´‡∏•‡∏±‡∏Å:**
  - ‡∏î‡∏π‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
  - **‡∏î‡∏π OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏î‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á** ‚ú® ‡πÉ‡∏´‡∏°‡πà!
  - ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å
  - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  - ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô

### 2. üì± LIFF App - ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
- ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô LIFF App
- Mobile-responsive design
- Pagination & Sorting

---

## üîë ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• LINE Credentials

### LINE Messaging API
- **Channel ID:** `2008409511`
- **Channel Secret:** `99b6f4656a2037e14c8975b5fb61916b`
- **Channel Access Token:** (‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô .env.local)

### LINE LIFF
- **LIFF ID:** `2008409515-erDb5ylB`
- **LIFF URL:** `https://liff.line.me/2008409515-erDb5ylB`

---

## üåê URLs Configuration

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö domain: `https://payroll-system-mu.vercel.app/`

### 1. Webhook URL (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LINE Messaging API)
```
https://payroll-system-mu.vercel.app/api/line/webhook
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô LINE Developers Console:**
1. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà [LINE Developers Console](https://developers.line.biz/)
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Provider ‡πÅ‡∏•‡∏∞ Channel ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Channel ID: 2008409511)
3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "Messaging API"
4. ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô "Webhook settings":
   - Webhook URL: `https://payroll-system-mu.vercel.app/api/line/webhook`
   - ‡πÄ‡∏õ‡∏¥‡∏î "Use webhook": ON
   - ‡πÄ‡∏õ‡∏¥‡∏î "Verify" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö webhook (‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ status 200)
5. ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô "Auto-reply messages": ‡∏õ‡∏¥‡∏î (OFF)
6. ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô "Greeting messages": ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

### 2. LIFF Endpoint URL
```
https://payroll-system-mu.vercel.app/liff/payroll
```

**‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô LINE Developers Console:**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "LIFF"
2. ‡∏Ñ‡∏•‡∏¥‡∏Å "Edit" ‡∏ö‡∏ô LIFF app ‡∏ó‡∏µ‡πà‡∏°‡∏µ LIFF ID: `2008409515-erDb5ylB`
3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
   - **Endpoint URL:** `https://payroll-system-mu.vercel.app/liff/payroll`
   - **Size:** Full (‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠)
   - **BLE feature:** OFF
   - **Scan QR:** OFF (‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)
4. ‡∏Ñ‡∏•‡∏¥‡∏Å "Update"

---

## üìÅ ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

### 1. LINE Webhook API (AI Agent with Database Access)
**‡πÑ‡∏ü‡∏•‡πå:** `app/api/line/webhook/route.ts`

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:**
- ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ LINE
- Verify signature ‡∏à‡∏≤‡∏Å LINE
- ‡πÉ‡∏ä‡πâ OpenAI GPT-4o-mini ‡∏û‡∏£‡πâ‡∏≠‡∏° **Function Calling** ‡πÄ‡∏û‡∏∑‡πà‡∏≠ query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Supabase
- ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ú‡πà‡∏≤‡∏ô LINE

**Features:**
- ü§ñ **AI Agent ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•** - ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
- üîç **5 Functions ‡∏´‡∏•‡∏±‡∏Å:**
  1. `get_top_ot_employees` - ‡∏î‡∏π‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
  2. `get_employee_ot_detail` - ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏î‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á (‡πÉ‡∏´‡∏°‡πà! ‚ú®)
  3. `get_department_summary` - ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å
  4. `search_employee` - ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
  5. `get_leave_stats` - ‡∏î‡∏π‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô
- üí¨ ‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏¥‡∏ï‡∏£
- ‚ö° Real-time data ‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- üìä ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å `payroll` table (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á)

### 2. LIFF Page
**‡πÑ‡∏ü‡∏•‡πå:** `app/liff/payroll/page.tsx`

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:**
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô 15 ‡∏ß‡∏±‡∏ô (Day 1-15)
- ‡πÅ‡∏™‡∏î‡∏á OT ‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô

**Features:**
- ‚úÖ Pagination: ‡πÅ‡∏™‡∏î‡∏á 10 ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤
- ‚úÖ Sort: ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠, ‡πÅ‡∏ú‡∏ô‡∏Å, ‡∏´‡∏£‡∏∑‡∏≠ OT ‡∏£‡∏ß‡∏° (‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ / ‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ‡∏°‡∏≤‡∏Å)
- ‚úÖ Mobile-responsive design
- ‚úÖ Color-coded OT display:
  - ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß: ‡∏ß‡∏±‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
  - ‡πÅ‡∏î‡∏á: ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå (√ó3)
- ‚úÖ Card-based layout ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠

### 3. LIFF API Endpoint
**‡πÑ‡∏ü‡∏•‡πå:** `app/api/liff/payroll/route.ts`

**‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:**
- API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OT ‡∏à‡∏≤‡∏Å database
- Return JSON format ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LIFF page

---

## üîß Environment Variables

‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß: `.env.local`

```bash
# LINE Messaging API
LINE_CHANNEL_ID=2008409511
LINE_CHANNEL_SECRET=99b6f4656a2037e14c8975b5fb61916b
LINE_CHANNEL_ACCESS_TOKEN=<your-token>

# LINE LIFF
NEXT_PUBLIC_LIFF_ID=2008409515-erDb5ylB

# OpenAI (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI Chatbot)
OPENAI_API_KEY=<your-openai-key>

# Supabase
NEXT_PUBLIC_SUPABASE_URL=<your-url>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<your-key>
```

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

### 1. LINE Bot (AI Agent with Real Data)
1. Add LINE Official Account ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô (QR Code ‡∏à‡∏≤‡∏Å LINE Developers Console)
2. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏≤‡∏° ‡πÄ‡∏ä‡πà‡∏ô:

**üìä ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Database):**
   - **"‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏≥ OT ‡πÄ‡∏¢‡∏≠‡∏∞‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?"**
     ‚Üí AI ‡∏à‡∏∞ query ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á Top 5 ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
   
   - **"‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤ ‡∏°‡∏µ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á OT ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?"** ‚ú® ‡πÉ‡∏´‡∏°‡πà!
     ‚Üí AI ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤ ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:
       ‚Ä¢ OT ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏° (‡∏à‡∏≤‡∏Å payroll.ot_hours)
       ‚Ä¢ OT ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ vs OT ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
       ‚Ä¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
       ‚Ä¢ ‡∏Ñ‡πà‡∏≤ OT (‡∏ö‡∏≤‡∏ó)
   
   - **"‡πÅ‡∏ú‡∏ô‡∏Å Production ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?"**
     ‚Üí AI ‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å Production
   
   - **"‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏≠ ‡∏™‡∏°‡∏ä‡∏≤‡∏¢"**
     ‚Üí AI ‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠
   
   - **"‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÑ‡∏´‡∏ô‡∏•‡∏≤‡∏á‡∏≤‡∏ô‡∏ö‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î?"**
     ‚Üí AI ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô

**‚ùì ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö):**
   - "‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OT ‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?"
   - "‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì OT ‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?"
   - "‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏≥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?"

3. Bot ‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÇ‡∏î‡∏¢:
   - Query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Database (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
   - ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô)

### 2. LIFF App (‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT)
1. ‡πÄ‡∏õ‡∏¥‡∏î LIFF URL ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡πà‡∏á Rich Menu ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡∏¥‡∏î LIFF
2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
3. ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:
   - ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏î‡∏π‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô (10 ‡∏Ñ‡∏ô/‡∏´‡∏ô‡πâ‡∏≤)
   - ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ" / "‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
   - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Sort field ‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (‚Üë‚Üì)

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Webhook
```bash
curl -X POST https://payroll-system-mu.vercel.app/api/line/webhook \
  -H "Content-Type: application/json" \
  -H "x-line-signature: test" \
  -d '{"events":[]}'
```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö LIFF API
```bash
curl https://payroll-system-mu.vercel.app/api/liff/payroll
```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö LIFF Page
‡πÄ‡∏õ‡∏¥‡∏î browser ‡πÅ‡∏•‡∏∞‡πÑ‡∏õ‡∏ó‡∏µ‡πà:
```
https://payroll-system-mu.vercel.app/liff/payroll
```

---

## üì± Screenshots / Features

### LINE Bot (AI Agent)
- ü§ñ **AI Agent ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Database ‡∏à‡∏£‡∏¥‡∏á**
- üîó **Function Calling** - AI ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ functions ‡πÄ‡∏û‡∏∑‡πà‡∏≠ query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- üìä **Query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (5 Functions):**
  - Top OT employees (Top 5 ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
  - **Employee OT detail** (‡∏î‡∏π OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏î‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á) ‚ú® ‡πÉ‡∏´‡∏°‡πà!
  - Department salary summary (‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å)
  - Employee search (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô)
  - Leave statistics (‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏á‡∏≤‡∏ô)
- üí¨ ‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
- ‚ö° Real-time data ‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- üìà **‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î OT ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô:**
  - OT ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏° (‡∏à‡∏≤‡∏Å payroll table)
  - OT ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ vs OT ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
  - ‡∏Ñ‡πà‡∏≤ OT (‡∏ö‡∏≤‡∏ó)
  - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô

### LIFF Page
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 10 ‡∏Ñ‡∏ô/‡∏´‡∏ô‡πâ‡∏≤
- Grid 5x3 ‡πÅ‡∏™‡∏î‡∏á OT 15 ‡∏ß‡∏±‡∏ô
- Sort controls (Dropdown + Toggle)
- Pagination buttons (‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ / ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
- Mobile-optimized UI

---

## üîê Security Notes

1. **Webhook Signature Verification**: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö signature ‡∏à‡∏≤‡∏Å LINE ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
2. **Environment Variables**: ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢ `.env.local` ‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞
3. **LIFF Login**: LIFF ‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ user login ‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

---

## üîß Technical Details: AI Agent Architecture

### Function Calling Flow
```
User Message ‚Üí LINE ‚Üí Webhook
                        ‚Üì
                  OpenAI API (GPT-4o-mini)
                        ‚Üì
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ AI decides which  ‚îÇ
              ‚îÇ function to call  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
            ‚îÇ Execute Function:     ‚îÇ
            ‚îÇ - get_top_ot_employees‚îÇ
            ‚îÇ - get_dept_summary    ‚îÇ
            ‚îÇ - search_employee     ‚îÇ
            ‚îÇ - get_leave_stats     ‚îÇ
            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
                 Query Supabase
                        ‚Üì
            Return Results to OpenAI
                        ‚Üì
              Generate Natural Response
                        ‚Üì
               Reply to User via LINE
```

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Function Call

#### 1. ‡∏ñ‡∏≤‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÉ‡∏´‡∏°‡πà! ‚ú®)
```json
// User: "‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤ ‡∏°‡∏µ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á OT ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?"

// AI ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å function
{
  "name": "get_employee_ot_detail",
  "arguments": { "search_term": "‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤" }
}

// Query Supabase ‡πÅ‡∏•‡∏∞ return
{
  "period": "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025 (2025-10-11 - 2025-10-25)",
  "employee": {
    "id": "20055675",
    "name": "‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤",
    "department": "Production"
  },
  "ot_summary": {
    "total_ot_hours_from_payroll": 66.5,
    "ot_amount": 9975.00,
    "regular_ot_hours": 54.5,
    "sunday_ot_actual_hours": 4.0,
    "sunday_ot_calculated_hours": 12.0,
    "total_ot_hours_from_daily": 66.5,
    "total_work_days": 13
  },
  "note": "‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á OT ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∑‡∏≠‡∏à‡∏≤‡∏Å payroll table ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á"
}

// AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
"‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤ ‡∏°‡∏µ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á OT ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:
üìä OT ‡∏£‡∏ß‡∏°: 66.5 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
üí∞ ‡∏Ñ‡πà‡∏≤ OT: 9,975 ‡∏ö‡∏≤‡∏ó

‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:
‚Ä¢ OT ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤: 54.5 ‡∏ä‡∏°.
‚Ä¢ OT ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå: 4 ‡∏ä‡∏°. (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô 12 ‡∏ä‡∏°.)
‚Ä¢ ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô: 13 ‡∏ß‡∏±‡∏ô

(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025)"
```

#### 2. ‡∏ñ‡∏≤‡∏° Top OT
```json
// AI ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å function
{
  "name": "get_top_ot_employees",
  "arguments": { "limit": 5 }
}

// Query Supabase ‡πÅ‡∏•‡∏∞ return
{
  "period": "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025 (2025-10-11 - 2025-10-25)",
  "employees": [
    {
      "name": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
      "department": "Production",
      "ot_hours": 45.5,
      "ot_amount": 6825
    },
    ...
  ]
}

// AI ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
"‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥ OT ‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î 5 ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÅ‡∏£‡∏Å‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2025 ‡∏Ñ‡∏∑‡∏≠:
1. ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ (Production) - 45.5 ‡∏ä‡∏°. (6,825 ‡∏ö‡∏≤‡∏ó)
..."
```

---

## üìù Next Steps

‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå:

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LINE Bot (AI Agent)
- ‚úÖ **‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Database ‡πÅ‡∏•‡πâ‡∏ß** - ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
- ‚úÖ **‡∏î‡∏π OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß** - ‡πÉ‡∏ä‡πâ `get_employee_ot_detail`
- ‡πÄ‡∏û‡∏¥‡πà‡∏° function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ OT ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÜ)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö (base + ot + deductions)
- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ (Quick Replies)
- ‡πÄ‡∏û‡∏¥‡πà‡∏° Rich Menu
- Session memory - ‡∏à‡∏≥‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤

### ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö LIFF
- ‡πÄ‡∏û‡∏¥‡πà‡∏° filter ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
- ‡πÄ‡∏û‡∏¥‡πà‡∏° date range selector
- ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å Excel
- ‡πÅ‡∏™‡∏î‡∏á chart / graph

---

## üÜò Troubleshooting

### Webhook ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ webhook URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Channel Secret ‡πÉ‡∏ô .env.local
3. ‡πÄ‡∏ä‡πá‡∏Ñ logs ‡πÉ‡∏ô Vercel dashboard
4. Verify webhook ‡πÉ‡∏ô LINE Developers Console

### AI Agent ‡∏ï‡∏≠‡∏ö‡∏ß‡πà‡∏≤ "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"
**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** AI ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ function ‡∏´‡∏£‡∏∑‡∏≠ database ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô database:**
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ `payroll_periods` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≠‡∏ö
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `payroll` ‡∏ó‡∏µ‡πà link ‡∏Å‡∏±‡∏ö period
   - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• `employees`

2. ‚úÖ **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Environment Variables:**
   ```bash
   NEXT_PUBLIC_SUPABASE_URL=...
   NEXT_PUBLIC_SUPABASE_ANON_KEY=...
   OPENAI_API_KEY=...
   ```

3. ‚úÖ **‡πÄ‡∏ä‡πá‡∏Ñ Vercel Logs** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π:
   - Function call ‡∏ó‡∏µ‡πà AI ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å
   - ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏à‡∏≤‡∏Å Supabase query
   - Response ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏´‡πâ AI

4. ‚úÖ **‡∏ó‡∏î‡∏™‡∏≠‡∏ö query ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á:**
   ```bash
   curl https://payroll-system-mu.vercel.app/api/liff/payroll
   ```
   ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô + OT

### AI Agent ‡∏ï‡∏≠‡∏ö‡∏ä‡πâ‡∏≤
- ‡∏õ‡∏Å‡∏ï‡∏¥: 3-5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (Function Calling ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
- ‡∏ñ‡πâ‡∏≤‡∏ä‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase query performance

### LIFF ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ payroll period ‡πÉ‡∏ô database
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Supabase connection
3. ‡πÄ‡∏ä‡πá‡∏Ñ browser console ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö errors
4. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ LIFF ID ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

---

## üìö ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- [LINE Messaging API Docs](https://developers.line.biz/en/docs/messaging-api/)
- [LINE LIFF Docs](https://developers.line.biz/en/docs/liff/)
- [OpenAI Function Calling](https://platform.openai.com/docs/guides/function-calling)
- [Next.js App Router](https://nextjs.org/docs/app)
- [Supabase Docs](https://supabase.com/docs)

---

## ‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î

### Version 2.1 - Employee OT Detail Function (Latest) ‚ú®
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 2025-11-03
- ‚úÖ **‡πÄ‡∏û‡∏¥‡πà‡∏° `get_employee_ot_detail` function** - ‡∏î‡∏π OT ‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏î‡∏Ñ‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
- ‚úÖ **‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î OT ‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô:**
  - OT ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å `payroll.ot_hours` (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á)
  - OT ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ vs OT ‡∏ß‡∏±‡∏ô‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå
  - ‡∏Ñ‡πà‡∏≤ OT (‡∏ö‡∏≤‡∏ó)
  - ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- ‚úÖ **‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏≤‡∏° "‡∏û‡∏¥‡∏ä‡∏¥‡∏ï‡∏ä‡∏±‡∏¢ ‡∏à‡∏≥‡∏õ‡∏≤‡∏™‡∏≤ ‡∏°‡∏µ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á OT ‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà?" ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (66.5 ‡∏ä‡∏°.)
- ‚úÖ **Query ‡∏à‡∏≤‡∏Å 2 tables:** `payroll` + `daily_attendance` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô

### Version 2.0 - AI Agent with Database Access
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:** 2025-11-03
- ‚úÖ **‡πÄ‡∏û‡∏¥‡πà‡∏° Function Calling** - AI ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase ‡πÑ‡∏î‡πâ
- ‚úÖ **4 Functions:** Top OT, Department Summary, Employee Search, Leave Stats
- ‚úÖ **Real-time Data** - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
- ‚úÖ **‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á** - ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ

### Version 1.0 - Basic LINE Integration
- ‚úÖ LINE Webhook API
- ‚úÖ LIFF Page ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô OT
- ‚úÖ Basic AI Chatbot (‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)

---

**‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢:** Claude Code (Sonnet 4.5)
**‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:** 2025-11-03
**Version:** 2.1 (Employee OT Detail + AI Agent)
