# คู่มือการใช้งาน Payroll System

## การเริ่มต้นใช้งาน

### ขั้นตอนที่ 1: นำเข้าข้อมูลพนักงาน

1. ไปที่หน้า **"พนักงาน"** จากเมนูด้านบน
2. คลิกปุ่ม **"นำเข้า CSV"**
3. เลือกไฟล์ข้อมูลพนักงาน (รูปแบบ Tab-separated)

**รูปแบบไฟล์:**
```
No.	Name	Department	CertificateType
20055885	เสาวลักษณ์ ชาวโคกหม้อ	Assembly	Other
20055547	เสาวณีย์ ชอบชื่น	Assembly	Other
```

### ขั้นตอนที่ 2: นำเข้าข้อมูลการแสกน

1. ไปที่หน้า **"บันทึกเวลา"**
2. วางข้อมูลที่ได้จาก API ของเครื่องสแกน หรืออัพโหลดไฟล์ .txt
3. คลิก **"นำเข้าข้อมูล"**

**รูปแบบข้อมูล:**
```
01	11-10-2025	00:27:19	'20056402		1
01	11-10-2025	00:37:30	'20056415		1
04	11-10-2025	20:13:39	'20055675		2
```

**คำอธิบาย:**
- คอลัมน์ 1: รหัสเครื่อง (01, 04, etc.)
- คอลัมน์ 2: วันที่ (DD-MM-YYYY)
- คอลัมน์ 3: เวลา (HH:MM:SS)
- คอลัมน์ 4: รหัสพนักงาน (มี ' นำหน้า)
- คอลัมน์ 5: ประเภท (1 = เข้างาน, 2 = ออกงาน)

### ขั้นตอนที่ 3: ตรวจสอบและแก้ไขข้อมูล

1. ไปที่ **"บันทึกเวลา" > "รายละเอียดรายวัน"**
2. ตรวจสอบเวลาเข้า-ออกงานของพนักงาน
3. ตรวจสอบ OT ที่คำนวณแล้ว
4. กรองข้อมูลตามวันที่หรือชื่อพนักงาน

### ขั้นตอนที่ 4: บันทึกการลางาน (ถ้ามี)

1. ไปที่หน้า **"การลางาน"**
2. ค้นหาพนักงานที่ต้องการบันทึกการลา
3. เลือกวันที่ลา
4. เลือกประเภทการลา (ลากิจ, ลาป่วย, ลาพักร้อน)
5. คลิก **"บันทึกการลา"**

### ขั้นตอนที่ 5: คำนวณเงินเดือน

1. ไปที่หน้า **"คำนวณเงินเดือน"**
2. กรอกข้อมูลรอบเงินเดือน:
   - ชื่อรอบ (เช่น "ตุลาคม 2025")
   - วันที่เริ่มต้น (เช่น 10 ต.ค. 2025)
   - วันที่สิ้นสุด (เช่น 25 ต.ค. 2025)
   - วันจ่ายเงิน
3. คลิก **"สร้างรอบเงินเดือน"**
4. คลิกปุ่ม **"คำนวณ"** ในรอบที่สร้าง
5. ระบบจะคำนวณเงินเดือนพนักงานทั้งหมดอัตโนมัติ

### ขั้นตอนที่ 6: ตรวจสอบและออกสลิป

1. ดูรายละเอียดเงินเดือนในตาราง
2. ตรวจสอบ:
   - เงินฐาน
   - ค่า OT
   - เงิน Gross (รวม)
   - หักภาษี
   - หักประกันสังคม
   - เงินสุทธิ (Net)
3. คลิกปุ่มสลิปเพื่อออกสลิปเงินเดือน PDF

## การทำงานของระบบ

### การคำนวณเวลาทำงานปกติ

ระบบจะกำหนดเวลาทำงานปกติตามเวลาที่พนักงานเข้างาน:

| เวลาเข้างาน | แผนก | เวลาเข้าปกติ | เวลาออกปกติ |
|-------------|------|--------------|-------------|
| 00:00-05:00 | ทุกแผนก | 00:30 | 05:30 |
| 05:01-07:30 | ขนส่ง | 08:00 | 17:00 |
| 05:01-07:30 | อื่นๆ | 06:00 | 17:00 |
| 07:31-08:00 | ขนส่ง | 08:00 | 17:30 |
| 07:31-08:00 | อื่นๆ | 06:00 | 17:30 |
| 08:01-12:00 | ทุกแผนก | 08:00 | 17:30 |
| 12:01-17:30 | ทุกแผนก | 13:00 | 17:30 |
| 17:31-23:59 | ทุกแผนก | 20:00 | 05:30 (วันถัดไป) |

### การคำนวณ OT

**OT เข้างานก่อนเวลา:**
- เวลาเข้าจริง < เวลาเข้าปกติ
- คำนวณส่วนต่าง แล้วปัดเศษ:
  - >= 30 นาที → +0.5 ชม.
  - < 30 นาที → 0 ชม.

**ตัวอย่าง:**
- เวลาเข้าปกติ: 08:00
- เข้างานจริง: 07:25 (ก่อน 35 นาที) → OT = 0.5 ชม.
- เข้างานจริง: 07:45 (ก่อน 15 นาที) → OT = 0 ชม.
- เข้างานจริง: 06:50 (ก่อน 70 นาที) → OT = 1.0 ชม.

**OT เลิกงานหลังเวลา:**
- เวลาออกจริง > เวลาออกปกติ
- คำนวณส่วนต่าง แล้วปัดเศษเหมือนกัน

**ตัวอย่าง:**
- เวลาออกปกติ: 17:30
- ออกงานจริง: 18:00 (หลัง 30 นาที) → OT = 0.5 ชม.
- ออกงานจริง: 18:50 (หลัง 80 นาที) → OT = 1.0 ชม.
- ออกงานจริง: 17:50 (หลัง 20 นาที) → OT = 0 ชม.

**OT รวมแต่ละวัน:**
```
OT รวม = OT เข้างานก่อนเวลา + OT เลิกงานหลังเวลา
```

### การคำนวณ OT ตามประเภทวัน

**วันธรรมดา (จันทร์-เสาร์):**
- นับ OT ตามจริง (1:1)

**วันอาทิตย์ (วันหยุด):**
- OT คูณ 3 เท่า
- ตัวอย่าง: ทำ OT 2 ชม. ในวันอาทิตย์ = 2 × 3 = 6 ชม.

**OT รวมทั้งหมด:**
```
OT รวม = OT วันธรรมดา + (OT วันอาทิตย์ × 3)
```

### การคำนวณเงินเดือน

```
เงินฐาน = 5,000 บาท/เดือน
ค่า OT ต่อชั่วโมง = 80 บาท

ค่า OT รวม = OT รวมทั้งหมด × 80
เงินเดือน Gross = เงินฐาน + ค่า OT รวม

ภาษี = คำนวณตามกฎหมาย (Progressive Tax)
ประกันสังคม = min(Gross × 5%, 750)

เงินสุทธิ (Net) = Gross - ภาษี - ประกันสังคม
```

**ตัวอย่าง:**
```
พนักงาน A:
- วันทำงาน: 15 วัน
- OT วันธรรมดา: 10 ชม.
- OT วันอาทิตย์: 4 ชม. (1 วัน)

OT รวม = 10 + (4 × 3) = 22 ชม.
ค่า OT = 22 × 80 = 1,760 บาท
Gross = 5,000 + 1,760 = 6,760 บาท
ประกันสังคม = 6,760 × 5% = 338 บาท
ภาษี = ~50 บาท (ประมาณการ)
Net = 6,760 - 338 - 50 = 6,372 บาท
```

## การจัดการกรณีพิเศษ

### พนักงานไม่แสกนออกงาน

1. ไปที่ **"บันทึกเวลา" > "รายละเอียดรายวัน"**
2. ดูรายการที่มีเวลาเข้าแต่ไม่มีเวลาออก
3. ตรวจสอบว่าพนักงานแสกนในวันถัดไปหรือไม่
4. ถ้าไม่มี ให้ติดต่อพนักงานเพื่อยืนยันเวลา

### พนักงานทำ OT ผิดปกติ (มากเกินไป)

1. ตรวจสอบเวลาเข้า-ออกว่าถูกต้อง
2. ตรวจสอบว่าเครื่องสแกนทำงานปกติ
3. ยืนยันกับหัวหน้างานหรือพนักงาน

### พนักงานลาแต่มีการแสกน

1. บันทึกการลาในระบบก่อน
2. ระบบจะอัพเดทสถานะ is_leave = true
3. เวลาทำงานในวันนั้นจะไม่นับรวม

## คำถามที่พบบ่อย (FAQ)

### Q: ทำไมข้อมูลการแสกนบางรายการไม่เข้า?
A: ตรวจสอบว่ารหัสพนักงานมีอยู่ในระบบแล้ว ต้องนำเข้าข้อมูลพนักงานก่อน

### Q: OT คำนวณไม่ตรงกับที่คาด?
A: ตรวจสอบ:
- แผนกของพนักงาน (ขนส่งมีกฎพิเศษ)
- วันที่ (วันอาทิตย์คูณ 3)
- การปัดเศษ (< 30 นาที = 0, >= 30 นาที = 0.5)

### Q: แก้ไขข้อมูลที่นำเข้าผิดได้ไหม?
A: ปัจจุบันต้องลบและนำเข้าใหม่ หรือแก้ไขผ่าน Supabase Console โดยตรง

### Q: ส่งออกรายงานเป็น Excel ได้ที่ไหน?
A: ไปที่หน้า "รายงาน" หรือคลิกปุ่ม "ส่งออก Excel" ในแต่ละหน้า

### Q: จะเพิ่มอัตราค่าจ้างพนักงานได้อย่างไร?
A: ตอนนี้ต้องแก้ไขผ่าน Supabase Console หรือสร้างหน้า UI สำหรับแก้ไข

## ติดต่อและขอความช่วยเหลือ

หากพบปัญหาหรือมีคำถาม กรุณาติดต่อทีมพัฒนาหรือ IT Support
